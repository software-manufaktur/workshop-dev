<!doctype html>
<html lang="de">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>tempio</title>
  <link rel="icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Crect width='100' height='100' rx='20' fill='%23222'/%3E%3Crect x='15' y='25' width='70' height='60' rx='5' fill='%23fff'/%3E%3Crect x='15' y='25' width='70' height='15' rx='5' fill='%23FF7043'/%3E%3Ccircle cx='35' cy='55' r='4' fill='%23222'/%3E%3Ccircle cx='50' cy='55' r='4' fill='%23222'/%3E%3Ccircle cx='65' cy='55' r='4' fill='%23222'/%3E%3Ccircle cx='35' cy='70' r='4' fill='%23222'/%3E%3Ccircle cx='50' cy='70' r='4' fill='%23FF7043'/%3E%3Ccircle cx='65' cy='70' r='4' fill='%23222'/%3E%3C/svg%3E">
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            brand: '#A88C5D',
            dark: '#1F2937',
            soft: '#E5E7EB',
            mid: '#D1D5DB'
          }
        }
      }
    }
  </script>
  <link rel="manifest" href="manifest.webmanifest">
  <meta name="theme-color" content="#222222">

  <!-- iOS PWA -->
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="default">
  <meta name="apple-mobile-web-app-title" content="tempio">
  <link rel="apple-touch-icon" href="static/icons/icon-192.png">

  <style>
    :root {
      --primary: #222;
      --accent: #FF7043;
      --bg: #ffffff;
      --text: #0f172a;
    }

    .no-scrollbar::-webkit-scrollbar {
      display: none;
    }

    .no-scrollbar {
      -ms-overflow-style: none;
      scrollbar-width: none;
    }

    .btn-primary {
      background: var(--primary);
      color: #fff;
    }

    .text-primary {
      color: var(--primary);
    }
  </style>
</head>

<body class="text-slate-900">
  <div id="updateBanner" class="hidden bg-amber-100 text-amber-900 border-b border-amber-200 px-4 py-3 flex items-center gap-3 justify-between">
    <span>Update verfuegbar. Bitte neu laden.</span>
    <button id="btnReloadUpdate" class="px-3 py-1 rounded-lg bg-amber-600 text-white text-sm">Neu laden</button>
  </div>

  <header class="max-w-4xl mx-auto px-4 py-6">
    <!-- Logo und Titel -->
    <div class="flex items-center justify-center gap-3 mb-6">
      <img id="brandLogo" src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Crect width='100' height='100' rx='20' fill='%23222'/%3E%3Crect x='15' y='25' width='70' height='60' rx='5' fill='%23fff'/%3E%3Crect x='15' y='25' width='70' height='15' rx='5' fill='%23FF7043'/%3E%3Ccircle cx='35' cy='55' r='4' fill='%23222'/%3E%3Ccircle cx='50' cy='55' r='4' fill='%23222'/%3E%3Ccircle cx='65' cy='55' r='4' fill='%23222'/%3E%3Ccircle cx='35' cy='70' r='4' fill='%23222'/%3E%3Ccircle cx='50' cy='70' r='4' fill='%23FF7043'/%3E%3Ccircle cx='65' cy='70' r='4' fill='%23222'/%3E%3C/svg%3E" alt="Logo" class="h-12 w-auto hidden">
      <h1 id="brandTitle" class="text-2xl font-semibold text-primary">tempio</h1>
    </div>
    
    <!-- Aktionen -->
    <div class="flex items-center justify-between">
      <button id="btnManageSlots" type="button" class="px-4 py-2 rounded-xl bg-dark text-white hover:opacity-90" data-label-terms-action>Termin anlegen</button>
      
      <div class="flex items-center gap-2">
        <button id="btnMenu" class="sm:hidden p-2 rounded-xl bg-soft hover:bg-mid text-dark" aria-label="Menue">â˜°</button>
        <div class="hidden sm:flex gap-2">
          <button id="btnArchiveView" type="button" class="px-3 py-2 rounded-xl bg-soft hover:bg-mid text-sm text-dark">Archiv</button>
          <button id="btnSettings" type="button" class="px-3 py-2 rounded-xl bg-soft hover:bg-mid text-sm text-dark">Einstellungen</button>
          <button id="btnQuickStart" type="button" class="px-3 py-2 rounded-xl bg-soft hover:bg-mid text-sm text-dark" title="Schnellstart-Anleitung">Hilfe</button>
        </div>
      </div>
    </div>
  </header>

  <!-- Mobile-Menue -->
  <div id="mobileMenu" class="fixed inset-0 z-50 hidden">
    <div class="absolute inset-0 bg-black/40" data-close="mobilemenu"></div>
    <div id="mobilePanel" class="absolute right-0 top-0 h-full w-[80%] max-w-xs bg-white shadow-2xl p-4 flex flex-col gap-3 translate-x-full transition-transform duration-200">
      <div class="flex items-center justify-between mb-2">
        <span class="text-lg font-semibold text-primary">Menue</span>
        <button class="text-slate-500 hover:text-slate-700" data-close="mobilemenu">X</button>
      </div>
      <div class="text-xs uppercase tracking-wide text-slate-500">Hauptbereich</div>
      <button id="m_btnQuickStart" type="button" class="px-3 py-3 rounded-xl bg-soft text-left text-dark">Hilfe & Schnellstart</button>
      <button id="m_btnManageSlots" type="button" class="px-3 py-3 rounded-xl bg-soft text-left text-dark" data-label-terms-action>Termin anlegen</button>
      <button id="m_btnArchiveView" type="button" class="px-3 py-3 rounded-xl bg-soft text-left text-dark">Archiv</button>
      <button id="m_btnSettings" type="button" class="px-3 py-3 rounded-xl bg-soft text-left text-dark">Einstellungen</button>

      <div class="text-xs uppercase tracking-wide text-slate-500 mt-4">Konto</div>
      <button id="m_btnLogin" type="button" class="px-3 py-3 rounded-xl bg-soft text-left text-dark">Anmelden</button>
      <button id="m_btnLogout" type="button" class="px-3 py-3 rounded-xl bg-soft text-left text-dark hidden">Abmelden</button>
      <div class="text-xs uppercase tracking-wide text-slate-500 mt-4">Debug</div>
      <button id="m_btnClearCache" type="button" class="px-3 py-3 rounded-xl bg-amber-500 text-white text-left">ğŸ”§ Speicher zurÃ¼cksetzen</button>
    </div>
  </div>

  <!-- Auth / Status -->
  <section class="max-w-4xl mx-auto px-4 py-3">
    <div class="flex flex-wrap gap-4 items-center text-sm bg-white/90 border border-gray-200 rounded-xl px-4 py-3">
      <!-- Status Badge -->
      <div class="flex items-center gap-2">
        <span id="statusDot" class="text-xl" aria-live="polite">âšª</span>
        <span id="autoBackupStatus" class="text-xs px-2 py-1 rounded-lg bg-blue-100 text-blue-700">ğŸ’¾ Auto-Backup</span>
      </div>
      
      <!-- Sync Info -->
      <div class="flex items-center gap-2">
        <span id="syncMeta" class="text-slate-700">Zuletzt aktualisiert: -</span>
      </div>
      
      <!-- Auth Status & Actions -->
      <div class="flex flex-wrap items-center gap-2 sm:gap-3 ml-auto">
        <span id="authStatus" class="text-slate-700 text-sm">Nicht angemeldet</span>
        <form id="authForm" class="flex gap-2 items-center w-full sm:w-auto">
          <input id="authEmail" type="email" required class="px-3 py-2 rounded-xl border border-gray-400/60 text-sm flex-1 sm:flex-initial sm:w-[200px]" placeholder="E-Mail">
          <button type="submit" class="px-3 py-2 rounded-xl bg-emerald-600 text-white text-sm hover:bg-emerald-700 whitespace-nowrap">Anmelden</button>
        </form>
        <button id="btnLogout" type="button" class="px-3 py-2 rounded-xl bg-rose-500 hover:bg-rose-600 text-white text-sm hidden whitespace-nowrap">Abmelden</button>
      </div>
    </div>
    
    <!-- Team Select (nur wenn angemeldet) -->
    <div class="mt-2 flex justify-end">
      <label class="flex items-center gap-2 text-sm">
        <span class="text-slate-600">Team:</span>
        <select id="teamSelect" class="px-3 py-2 rounded-xl border border-gray-400/60 min-w-[180px]">
          <option value="">Lokaler Modus</option>
        </select>
      </label>
    </div>
  </section>

  <!-- Suche + Filter -->
  <section class="max-w-4xl mx-auto px-4">
    <div class="grid grid-cols-1 sm:grid-cols-[1fr_auto] gap-3 my-3">
      <input id="search" class="w-full px-3 py-3 rounded-xl border border-mid/60 bg-white/90 backdrop-blur" placeholder="Suche nach Datum, Titel">
      <select id="filterStatus" class="px-3 py-3 rounded-xl border border-mid/60 bg-white/90 min-w-[120px]">
        <option value="">alle</option>
        <option value="open">offen</option>
        <option value="full">voll</option>
        <option value="past">vergangen</option>
        <option value="archived">archiv</option>
      </select>
    </div>
  </section>

  <!-- Slot-Liste -->
  <main class="max-w-4xl mx-auto px-4 pb-28" id="list"></main>

  <!-- Einstellungen Modal -->
  <div id="modalSettings" class="fixed inset-0 z-50 bg-black/40 hidden items-center justify-center p-4">
    <div class="bg-white rounded-2xl shadow-xl w-full max-w-3xl max-h-[85vh] flex flex-col">
      <div class="sticky top-0 bg-white border-b border-gray-200 px-6 py-4 flex items-center justify-between rounded-t-2xl">
        <h2 class="text-xl font-bold text-primary">Einstellungen</h2>
        <button data-close="settings" class="text-slate-500 hover:text-slate-700 text-2xl leading-none">&times;</button>
      </div>
      
      <!-- Tabs -->
      <div class="flex border-b border-gray-200 px-6 bg-gray-50">
        <button class="tab-button px-4 py-3 font-medium border-b-2 border-transparent hover:border-gray-300 transition" data-tab="team">
          ğŸ›ï¸ Team
        </button>
        <button class="tab-button px-4 py-3 font-medium border-b-2 border-transparent hover:border-gray-300 transition" data-tab="backup">
          ğŸ’¾ Backup
        </button>
        <button class="tab-button px-4 py-3 font-medium border-b-2 border-primary text-primary" data-tab="branding">
          ğŸ¨ Design
        </button>
      </div>
      
      <div class="flex-1 overflow-y-auto p-6">
        <!-- Tab: Team -->
        <div class="tab-content hidden" data-tab-content="team">
          <div class="space-y-4">
            <!-- Aktuelle Organisation -->
            <div id="currentOrgInfo" class="bg-gradient-to-br from-blue-50 to-indigo-50 border border-blue-200 rounded-xl p-5">
              <div class="flex items-start justify-between gap-4">
                <div class="flex-1">
                  <div class="text-xs uppercase tracking-wide text-blue-600 mb-1 font-semibold">Deine Organisation</div>
                  <div id="currentOrgName" class="font-bold text-xl text-slate-900 mb-1">-</div>
                  <div id="currentOrgRole" class="text-sm text-slate-600">-</div>
                </div>
                <button id="btnEditOrgName" class="px-4 py-2 rounded-xl bg-white border border-blue-300 hover:bg-blue-50 text-sm font-medium text-blue-700 shadow-sm hidden">âœï¸ Bearbeiten</button>
              </div>
            </div>
            
            <!-- Organisation umbenennen -->
            <form id="formRenameOrg" class="hidden bg-white border-2 border-blue-300 rounded-xl p-4 space-y-3 shadow-sm">
              <label class="flex flex-col gap-1">
                <span class="text-sm font-semibold text-slate-700">Neuer Name</span>
                <input id="inputOrgNewName" type="text" required class="px-3 py-2 rounded-xl border-2 border-blue-200 focus:border-blue-500 outline-none" placeholder="Mein Team">
              </label>
              <div class="flex gap-2">
                <button type="submit" class="flex-1 px-4 py-2 rounded-xl text-white bg-blue-600 hover:bg-blue-700 font-medium">Speichern</button>
                <button type="button" id="btnCancelRenameOrg" class="px-4 py-2 rounded-xl bg-gray-200 hover:bg-gray-300 font-medium">Abbrechen</button>
              </div>
            </form>
            
            <!-- Einladungslink -->
            <div id="inviteSection" class="hidden bg-gradient-to-br from-emerald-50 to-teal-50 border border-emerald-200 rounded-xl p-5 space-y-3">
              <div class="flex items-center gap-2">
                <span class="text-2xl">ğŸ‘¥</span>
                <div class="font-bold text-lg text-slate-900">Mitglieder einladen</div>
              </div>
              <p class="text-sm text-slate-600">Teile diesen Link mit deinem Team:</p>
              <div class="flex gap-2">
                <input id="inviteLink" type="text" readonly class="flex-1 px-3 py-2 rounded-xl border-2 border-emerald-300 bg-white text-sm font-mono" placeholder="Link wird generiert...">
                <button id="btnCopyInvite" type="button" class="px-4 py-2 rounded-xl bg-emerald-600 text-white hover:bg-emerald-700 font-medium shadow-sm">ğŸ“‹ Kopieren</button>
              </div>
              <p class="text-xs text-slate-500">Der Link ist 7 Tage gÃ¼ltig. Neue Mitglieder werden als "User" hinzugefÃ¼gt.</p>
            </div>
            
            <!-- Neue Organisation erstellen -->
            <details class="bg-white border border-gray-200 rounded-xl overflow-hidden">
              <summary class="px-5 py-3 cursor-pointer hover:bg-gray-50 font-semibold text-slate-700 flex items-center gap-2">
                <span>â•</span> Neue Organisation erstellen
              </summary>
              <form id="formCreateOrg" class="p-5 pt-3 space-y-3 border-t border-gray-200 bg-gray-50">
                <label class="flex flex-col gap-1">
                  <span class="text-sm font-medium">Name der Organisation</span>
                  <input id="inputOrgName" type="text" required class="px-3 py-2 rounded-xl border border-gray-300" placeholder="Meine neue Organisation">
                </label>
                <button type="submit" class="w-full px-4 py-2 rounded-xl text-white btn-primary hover:opacity-90">Organisation erstellen</button>
              </form>
            </details>
          </div>
        </div>

        <!-- Tab: Backup -->
        <div class="tab-content hidden" data-tab-content="backup">
          <div class="space-y-4">
            <div class="flex items-center justify-between mb-3">
              <h3 class="font-semibold text-lg text-primary">ğŸ“¦ Backup-Verwaltung</h3>
              <button id="btnBackupHelp" type="button" class="text-blue-500 hover:text-blue-700 text-sm" title="Hilfe zu Backups">â„¹ï¸ Hilfe</button>
            </div>
            
            <div class="bg-blue-50 border border-blue-200 rounded-xl p-4 text-sm">
              <p><strong>Automatische Sicherung:</strong> Alle Ã„nderungen werden sofort auf deinem GerÃ¤t gespeichert.</p>
              <p class="mt-1"><strong>Online-Speicherung:</strong> Bei Anmeldung werden deine Daten automatisch online gesichert.</p>
            </div>
            
            <!-- Export & Backup Aktionen -->
            <div class="flex flex-wrap gap-3">
              <button id="btnExportCsv" type="button" class="px-4 py-2 rounded-xl bg-emerald-600 text-white hover:bg-emerald-700 text-sm flex items-center gap-2">
                <span>ğŸ“Š</span> CSV exportieren
              </button>
              <button id="btnBackup" type="button" class="px-4 py-2 rounded-xl text-white btn-primary hover:opacity-90 text-sm flex items-center gap-2">
                <span>ğŸ’¾</span> JSON Backup
              </button>
              <label for="fileRestore" class="px-4 py-2 rounded-xl bg-blue-600 text-white hover:bg-blue-700 text-sm cursor-pointer flex items-center gap-2">
                <span>ğŸ“¥</span> Backup wiederherstellen
              </label>
              <input type="file" id="fileRestore" accept="application/json" class="hidden">
            </div>
            
            <div>
              <h4 class="font-semibold mb-2">Lokale Sicherungen (letzte 10)</h4>
              <ul id="localBackups" class="space-y-1 text-sm bg-slate-50 border border-slate-200 rounded-xl p-3 max-h-48 overflow-y-auto"></ul>
            </div>
            
            <div>
              <h4 class="font-semibold mb-2">Online-Sicherungen (automatisch)</h4>
              <ul id="serverBackups" class="space-y-1 text-sm bg-slate-50 border border-slate-200 rounded-xl p-3 max-h-48 overflow-y-auto"></ul>
            </div>
          </div>
        </div>

        <!-- Tab: Branding/Design -->
        <div class="tab-content" data-tab-content="branding">
          <div class="space-y-4">
            <div class="flex items-center justify-between mb-3">
              <h3 class="font-semibold text-lg text-primary">ğŸ¨ Design anpassen</h3>
              <span id="brandingRoleHint" class="text-xs text-slate-500"></span>
            </div>
            
            <form id="brandingForm" class="grid grid-cols-1 md:grid-cols-2 gap-4">
              <label class="flex flex-col gap-1">
                <span class="text-sm font-medium">App-Name</span>
                <input id="brandAppName" type="text" class="px-3 py-2 rounded-xl border border-gray-400/60" placeholder="tempio">
              </label>
              <label class="flex flex-col gap-1">
                <span class="text-sm font-medium">Logo URL (optional)</span>
                <input id="brandLogoUrl" type="url" class="px-3 py-2 rounded-xl border border-gray-400/60" placeholder="https://.../logo.png">
              </label>
              <label class="flex flex-col gap-1">
                <span class="text-sm font-medium">PrimÃ¤rfarbe</span>
                <input id="brandPrimary" type="text" class="px-3 py-2 rounded-xl border border-gray-400/60" placeholder="#222">
              </label>
              <label class="flex flex-col gap-1">
                <span class="text-sm font-medium">Akzentfarbe</span>
                <input id="brandAccent" type="text" class="px-3 py-2 rounded-xl border border-gray-400/60" placeholder="#FF7043">
              </label>
              <label class="flex flex-col gap-1">
                <span class="text-sm font-medium">Terms Label</span>
                <input id="brandTermsLabel" type="text" class="px-3 py-2 rounded-xl border border-gray-400/60" placeholder="Termine">
              </label>
              <label class="flex flex-col gap-1">
                <span class="text-sm font-medium">Bookings Label</span>
                <input id="brandBookingsLabel" type="text" class="px-3 py-2 rounded-xl border border-gray-400/60" placeholder="Buchungen">
              </label>
              <label class="flex flex-col gap-1 md:col-span-2">
                <span class="text-sm font-medium">Kategorien (kommagetrennt)</span>
                <input id="brandCategories" type="text" class="px-3 py-2 rounded-xl border border-gray-400/60" placeholder="Workshop, Kurs, Event, Seminar">
                <span class="text-xs text-slate-500">Diese Kategorien erscheinen beim Termin anlegen</span>
              </label>
              <div class="md:col-span-2 flex gap-2 items-center">
                <button id="brandingSave" type="submit" class="px-4 py-2 rounded-xl text-white btn-primary">Speichern</button>
                <span id="brandingInfo" class="text-xs text-slate-500"></span>
              </div>
            </form>
            <div id="brandingReadonly" class="hidden text-sm text-slate-600 bg-slate-50 border border-slate-200 rounded-xl p-3 mt-3"></div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Modal: Buchung -->
  <div id="modalBooking" class="fixed inset-0 z-50 bg-black/40 hidden items-center justify-center p-4">
    <div class="bg-white rounded-2xl shadow-xl w-full max-w-lg p-5" role="dialog" aria-modal="true">
      <div class="flex items-center justify-between mb-3">
        <h2 id="modalBookingTitle" class="text-lg font-semibold text-primary" data-label-bookings>Teilnehmer</h2>
        <button data-close="booking" class="text-slate-500 hover:text-slate-700" aria-label="Schliessen">X</button>
      </div>
      <form id="formBooking" class="grid grid-cols-1 md:grid-cols-2 gap-3">
        <label class="flex flex-col gap-1">
          <span class="text-sm">Anrede</span>
          <select id="bk_salutation" class="px-3 py-2 rounded-xl border border-gray-400/60">
            <option value="Liebe/r">Liebe/r</option>
            <option value="Liebe">Liebe</option>
            <option value="Lieber">Lieber</option>
          </select>
        </label>
        <label class="flex flex-col gap-1">
          <span class="text-sm">Name *</span>
          <input required type="text" id="bk_name" class="px-3 py-2 rounded-xl border border-gray-400/60">
        </label>
        <label class="flex flex-col gap-1">
          <span class="text-sm">Telefon *</span>
          <input required type="tel" id="bk_phone" class="px-3 py-2 rounded-xl border border-gray-400/60">
        </label>
        <label class="flex flex-col gap-1">
          <span class="text-sm">Personen *</span>
          <input required type="number" min="1" step="1" id="bk_count" class="px-3 py-2 rounded-xl border border-gray-400/60" value="1">
        </label>
        <label class="flex flex-col gap-1">
          <span class="text-sm">Kontaktkanal</span>
          <select id="bk_channel" class="px-3 py-2 rounded-xl border border-gray-400/60">
            <option value="">-</option>
            <option>Instagram</option>
            <option>WhatsApp</option>
            <option>E-Mail</option>
            <option>Triviar</option>
            <option>Telefonisch</option>
            <option>Persoenlich</option>
          </select>
        </label>
        <label class="md:col-span-2 flex flex-col gap-1">
          <span class="text-sm">Notiz</span>
          <textarea id="bk_notes" rows="3" class="px-3 py-2 rounded-xl border border-gray-400/60"></textarea>
        </label>
        <div class="md:col-span-2 flex flex-col sm:flex-row gap-2">
          <button type="button" id="btnDeleteBooking" class="w-full sm:w-auto px-4 py-2 rounded-xl bg-rose-100 text-rose-700 hidden">Loeschen</button>
          <button type="button" id="btnWhatsappShare" class="w-full sm:w-auto px-4 py-2 rounded-xl bg-emerald-600 text-white hidden">WhatsApp</button>
          <button type="button" data-close="booking" class="w-full sm:w-auto px-4 py-2 rounded-xl bg-gray-200">Abbrechen</button>
          <button type="submit" class="w-full sm:w-auto px-4 py-2 rounded-xl text-white btn-primary">Speichern</button>
        </div>
      </form>
    </div>
  </div>

  <!-- Modal: Termin -->
  <div id="modalSlots" class="fixed inset-0 z-50 bg-black/40 hidden items-center justify-center p-4">
    <div class="bg-white rounded-2xl shadow-xl w-full max-w-lg p-5" role="dialog" aria-modal="true">
      <div class="flex items-center justify-between mb-3">
        <h2 class="text-lg font-semibold text-primary" data-label-terms-modal>Termin anlegen / bearbeiten</h2>
        <button data-close="slots" class="text-slate-500 hover:text-slate-700" aria-label="Schliessen">X</button>
      </div>
      <form id="formSlot" class="grid grid-cols-1 md:grid-cols-2 gap-3">
        <label class="flex flex-col gap-1 md:col-span-2">
          <span class="text-sm">Kategorie</span>
          <select id="sl_category" class="px-3 py-2 rounded-xl border border-gray-400/60">
            <!-- Kategorien werden dynamisch geladen -->
          </select>
        </label>
        <label class="flex flex-col gap-1 md:col-span-2" id="row_title_other" style="display:none">
          <span class="text-sm">Titel (bei Sonstiges)</span>
          <input type="text" id="sl_title_other" class="px-3 py-2 rounded-xl border border-gray-400/60" placeholder="Eigener Titel">
        </label>
        <label class="flex flex-col gap-1">
          <span class="text-sm">Kapazitaet *</span>
          <input type="number" min="1" step="1" id="sl_capacity" class="px-3 py-2 rounded-xl border border-gray-400/60" value="10" required>
        </label>
        <label class="flex flex-col gap-1">
          <span class="text-sm">Start *</span>
          <input type="datetime-local" id="sl_starts" class="px-3 py-2 rounded-xl border border-gray-400/60" required>
        </label>
        <label class="flex flex-col gap-1">
          <span class="text-sm">Ende *</span>
          <input type="datetime-local" id="sl_ends" class="px-3 py-2 rounded-xl border border-gray-400/60" required>
        </label>
        <div class="md:col-span-2 flex flex-col sm:flex-row gap-2">
          <button type="button" data-close="slots" class="w-full sm:w-auto px-4 py-2 rounded-xl bg-gray-200">Abbrechen</button>
          <button type="submit" class="w-full sm:w-auto px-4 py-2 rounded-xl text-white btn-primary">Speichern</button>
        </div>
      </form>
    </div>
  </div>

  <!-- Modal: Termin loeschen bestaetigen -->
  <div id="modalConfirmDelete" class="fixed inset-0 z-50 bg-black/40 hidden items-center justify-center p-4">
    <div class="bg-white rounded-2xl shadow-xl w-full max-w-md p-6">
      <div class="flex items-start gap-3">
        <div class="text-2xl">!</div>
        <div>
          <h3 class="text-xl font-semibold mb-1 text-rose-700">Achtung</h3>
          <p class="text-slate-700">Termin wirklich loeschen? Alle zugehoerigen Buchungen werden ebenfalls geloescht.</p>
        </div>
      </div>
      <div class="mt-5 flex justify-end gap-2">
        <button id="btnCancelDelete" class="px-4 py-2 rounded-xl bg-gray-200">Abbrechen</button>
        <button id="btnConfirmDelete" class="px-4 py-2 rounded-xl bg-rose-600 text-white">Endgueltig loeschen</button>
      </div>
    </div>
  </div>

  <!-- Modal: Backup Import -->
  <div id="modalBackupImport" class="fixed inset-0 z-50 bg-black/40 hidden items-center justify-center p-4">
    <div class="bg-white rounded-2xl shadow-xl w-full max-w-md p-6">
      <h3 class="text-lg font-semibold mb-2 text-primary">Backup wiederherstellen</h3>
      <p class="text-sm text-slate-700 mb-4">Datei: <span id="importFileName" class="font-medium">-</span></p>
      <p class="text-sm text-slate-700 mb-4">Inhalt: <span id="importCounts" class="font-medium">-</span></p>
      <div class="flex justify-end gap-2">
        <button id="btnCancelImport" data-close="backupimport" class="px-4 py-2 rounded-xl bg-gray-200">Abbrechen</button>
        <button id="btnConfirmImport" class="px-4 py-2 rounded-xl bg-emerald-600 text-white">Wiederherstellen</button>
      </div>
    </div>
  </div>

  <!-- Modal: Schnellstart -->
  <div id="modalQuickStart" class="fixed inset-0 z-50 bg-black/40 hidden items-center justify-center p-4">
    <div class="bg-white rounded-2xl shadow-xl w-full max-w-3xl p-6 max-h-[90vh] overflow-y-auto">
      <div class="flex items-start justify-between mb-4">
        <h3 class="text-2xl font-bold text-primary">ğŸš€ Schnellstart â€“ In 4 Schritten startklar</h3>
        <button data-close="quickstart" class="text-slate-500 hover:text-slate-700 text-2xl leading-none">&times;</button>
      </div>
      
      <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
        <!-- Schritt 1: Termin anlegen -->
        <div class="bg-gradient-to-br from-blue-50 to-blue-100 border-2 border-blue-300 rounded-xl p-5">
          <div class="text-3xl mb-2">ğŸ“…</div>
          <h4 class="font-bold text-lg mb-2 text-blue-900">1. Termin anlegen</h4>
          <p class="text-sm text-blue-800 mb-3">Erstelle deinen ersten Workshop oder Kurs mit wenigen Klicks.</p>
          <ul class="text-sm text-blue-700 space-y-1 list-disc ml-4">
            <li>Klicke auf "Termin anlegen"</li>
            <li>Titel, Datum und KapazitÃ¤t eingeben</li>
            <li>Fertig â€“ sofort verfÃ¼gbar!</li>
          </ul>
        </div>

        <!-- Schritt 2: Buchungen verwalten -->
        <div class="bg-gradient-to-br from-green-50 to-green-100 border-2 border-green-300 rounded-xl p-5">
          <div class="text-3xl mb-2">âœ…</div>
          <h4 class="font-bold text-lg mb-2 text-green-900">2. Buchungen annehmen</h4>
          <p class="text-sm text-green-800 mb-3">Teilnehmer kÃ¶nnen sich direkt fÃ¼r Termine anmelden.</p>
          <ul class="text-sm text-green-700 space-y-1 list-disc ml-4">
            <li>Klicke auf einen Termin</li>
            <li>"Buchen"-Button fÃ¼r Anmeldungen</li>
            <li>Name, Telefon, Personenzahl erfassen</li>
          </ul>
        </div>

        <!-- Schritt 3: Cloud-Sync -->
        <div class="bg-gradient-to-br from-purple-50 to-purple-100 border-2 border-purple-300 rounded-xl p-5">
          <div class="text-3xl mb-2">â˜ï¸</div>
          <h4 class="font-bold text-lg mb-2 text-purple-900">3. Anmelden (optional)</h4>
          <p class="text-sm text-purple-800 mb-3">Nutze die App von mehreren GerÃ¤ten und im Team.</p>
          <ul class="text-sm text-purple-700 space-y-1 list-disc ml-4">
            <li>E-Mail eingeben â†’ Magic Link erhalten</li>
            <li>Automatische Cloud-Synchronisation</li>
            <li>Zugriff von Handy, Tablet & PC</li>
          </ul>
        </div>

        <!-- Schritt 4: Backups -->
        <div class="bg-gradient-to-br from-amber-50 to-amber-100 border-2 border-amber-300 rounded-xl p-5">
          <div class="text-3xl mb-2">ğŸ’¾</div>
          <h4 class="font-bold text-lg mb-2 text-amber-900">4. Datensicherheit</h4>
          <p class="text-sm text-amber-800 mb-3">Deine Daten sind automatisch geschÃ¼tzt.</p>
          <ul class="text-sm text-amber-700 space-y-1 list-disc ml-4">
            <li>Automatische lokale Speicherung</li>
            <li>Online: Cloud-Backup bei jedem Sync</li>
            <li>Extra: JSON-Export fÃ¼r manuelle Backups</li>
          </ul>
        </div>
      </div>

      <!-- ZusÃ¤tzliche Tipps -->
      <div class="bg-slate-50 border border-slate-200 rounded-xl p-4 mb-4">
        <h4 class="font-semibold text-base mb-2 flex items-center gap-2">
          <span>ğŸ’¡</span>
          <span>Wichtige Tipps</span>
        </h4>
        <ul class="text-sm text-slate-700 space-y-2">
          <li><strong>Offline-fÃ¤hig:</strong> Die App funktioniert auch ohne Internet â€“ Ã„nderungen werden spÃ¤ter synchronisiert</li>
          <li><strong>Archiv:</strong> Vergangene Termine werden automatisch archiviert, bleiben aber abrufbar</li>
          <li><strong>CSV-Export:</strong> Exportiere Teilnehmerlisten fÃ¼r externe Verwendung</li>
          <li><strong>Team-Modus:</strong> Lade Kollegen ein, um gemeinsam Termine zu verwalten</li>
        </ul>
      </div>

      <!-- Call-to-Action -->
      <div class="flex flex-col sm:flex-row gap-3">
        <button data-close="quickstart" class="flex-1 px-4 py-3 rounded-xl bg-primary text-white font-semibold hover:opacity-90">Los geht's! ğŸš€</button>
        <button id="btnShowBackupHelp" class="px-4 py-3 rounded-xl bg-slate-200 hover:bg-slate-300 text-slate-700">ğŸ“š Backup-Hilfe Ã¶ffnen</button>
      </div>
    </div>
  </div>

  <!-- Modal: Backup-Hilfe -->
  <div id="modalBackupHelp" class="fixed inset-0 z-50 bg-black/40 hidden items-center justify-center p-4">
    <div class="bg-white rounded-2xl shadow-xl w-full max-w-2xl p-6 max-h-[80vh] overflow-y-auto">
      <div class="flex items-start justify-between mb-4">
        <h3 class="text-xl font-bold text-primary">ğŸ“š Backup & Wiederherstellung erklÃ¤rt</h3>
        <button data-close="backuphelp" class="text-slate-500 hover:text-slate-700 text-2xl leading-none">&times;</button>
      </div>
      
      <div class="space-y-4 text-sm text-slate-700">
        <section>
          <h4 class="font-semibold text-base mb-2 text-primary">ğŸ”„ Automatische Sicherung</h4>
          <p class="mb-2">Deine Termine werden automatisch gespeichert:</p>
          <ul class="list-disc ml-5 space-y-1">
            <li><strong>Auf deinem GerÃ¤t:</strong> Jede Ã„nderung wird sofort lokal gesichert (bis zu 10 automatische Backups)</li>
            <li><strong>Online:</strong> Wenn du angemeldet bist, werden alle Ã„nderungen zusÃ¤tzlich online gespeichert</li>
            <li><strong>Kein Verlust:</strong> Selbst ohne Internet sind deine Daten sicher â€“ sie werden synchronisiert, sobald du wieder online bist</li>
          </ul>
        </section>

        <section class="border-t pt-4">
          <h4 class="font-semibold text-base mb-2 text-primary">ğŸ’¾ Manuelles JSON-Backup</h4>
          <p class="mb-2">Nutze den "JSON Backup"-Button fÃ¼r:</p>
          <ul class="list-disc ml-5 space-y-1">
            <li><strong>Extra-Sicherheit:</strong> Download einer Backup-Datei auf deinem Computer</li>
            <li><strong>Datenaustausch:</strong> Ãœbertragung auf ein anderes GerÃ¤t</li>
            <li><strong>Archivierung:</strong> Langzeit-Sicherung wichtiger Daten</li>
          </ul>
        </section>

        <section class="border-t pt-4">
          <h4 class="font-semibold text-base mb-2 text-primary">â™»ï¸ Wiederherstellen</h4>
          <p class="mb-2">So stellst du ein Backup wieder her:</p>
          <ol class="list-decimal ml-5 space-y-1">
            <li><strong>Lokale Backups:</strong> Klicke in der Liste auf "Wiederherstellen" â€“ deine Daten werden sofort zurÃ¼ckgesetzt</li>
            <li><strong>JSON-Datei:</strong> Klicke "Wiederherstellen", wÃ¤hle die Backup-Datei aus und bestÃ¤tige</li>
            <li><strong>âš ï¸ Achtung:</strong> Bestehende Daten werden Ã¼berschrieben! Bei Unsicherheit vorher ein neues Backup erstellen</li>
          </ol>
        </section>

        <section class="border-t pt-4">
          <h4 class="font-semibold text-base mb-2 text-primary">â˜ï¸ Online-Speicherung</h4>
          <p class="mb-2">Vorteile der Anmeldung:</p>
          <ul class="list-disc ml-5 space-y-1">
            <li>Zugriff von mehreren GerÃ¤ten (Handy, Tablet, Computer)</li>
            <li>Automatische Synchronisation im Hintergrund</li>
            <li>Team-Funktionen: Gemeinsam Termine verwalten</li>
            <li>Daten bleiben auch bei GerÃ¤tewechsel oder Neuinstallation erhalten</li>
          </ul>
        </section>

        <section class="border-t pt-4 bg-blue-50 -mx-6 -mb-6 p-6 rounded-b-2xl">
          <h4 class="font-semibold text-base mb-2 text-blue-800">ğŸ’¡ Empfehlung</h4>
          <p><strong>FÃ¼r Normalnutzung:</strong> Einfach anmelden und automatisch speichern lassen â€“ fertig!</p>
          <p class="mt-2"><strong>FÃ¼r wichtige Events:</strong> ZusÃ¤tzlich vor dem Event ein JSON-Backup herunterladen.</p>
        </section>
      </div>
    </div>
  </div>  <!-- Footer -->
  <footer class="max-w-4xl mx-auto px-4 py-6 mt-12 border-t border-gray-200">
    <div class="flex flex-wrap justify-center gap-4 text-sm text-slate-600">
      <a href="./legal.html" target="_blank" rel="noopener" class="hover:text-primary underline">Rechtliches</a>
    </div>
  </footer>

  <!-- Toast -->
  <div id="toast" class="fixed top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 bg-white/95 backdrop-blur-sm border-2 border-gray-300 shadow-2xl rounded-2xl px-6 py-4 hidden z-[100] min-w-[300px] text-center">
    <span id="toastMsg" class="text-sm"></span>
    <a id="toastLink" href="#" target="_blank" class="ml-3 underline text-primary">Oeffnen</a>
  </div>

  <script>
    window.APP_CONFIG = {
      SUPABASE_URL: "https://mpgmsxkibyytdfaswpoa.supabase.co",
      SUPABASE_ANON_KEY: "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im1wZ21zeGtpYnl5dGRmYXN3cG9hIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjU4MDc4MDUsImV4cCI6MjA4MTM4MzgwNX0.isQbD5QbXBAUGxJzz6Sb2VCZCVbjs5t8bOii0QTQZNE"
    };
  </script>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.45.3/dist/umd/supabase.js" crossorigin="anonymous"></script>
  <script src="app.js?v=6"></script>
  <script>
    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.register('./service-worker.js').catch(console.error);
    }
  </script>

  <!-- Debug Overlay (nur bei ?debug=1 sichtbar) -->
  <div id="debugPanel" class="hidden fixed bottom-4 left-4 right-4 md:left-auto md:right-4 md:max-w-2xl z-50 text-xs text-slate-700 bg-yellow-50/95 backdrop-blur-sm border-2 border-yellow-300 rounded-xl px-3 py-2 shadow-lg font-mono"></div>
</body>

</html>
